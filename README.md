品名と型式から品番頭文字3桁をAIが予測してくれます。

# トップ画面
![image.png](/attachment/63759eb3a4a99ce0571e3648)

localhost:8880 へアクセスしたら、品名または型式あるいはその両方を入力し、品番予測ボタンをクリックします。

# 予測結果の表示
![image.png](/attachment/6376cc17a4a99ce0571e5ba4)

品番データ学習済みのAIが品名と型式から判断して、適切な品番カテゴリを表示します。

アイコンにマウスカーソルを乗せることで、予測確率を表示します。[^1]

[^1]: 予測確率は学習数に強く依存します。
例えば、本当はAZBというカテゴリが正しく見えるのに、AZBという品番がこれまでに1件しか登録されておらず、一方でAAAというカテゴリが10,000件も登録されていた場合、機械はAAAの予測確率を99%以上として提案してくるかもしれません。
あるいは、同一カテゴリに属する品番がこれまでに一件も前例がない場合、機械が学習できませんので、適切なカテゴリを提案することができません。
よって、AIによる提案と提示される予測確率は[標準部品記号一覧]および人間の感覚とずれる可能性がありますので、参考程度としてください。



# 同一カテゴリに属する品番表示
![image.png](/attachment/63759efba4a99ce0571e369a)

カテゴリボタンをクリックするたびに、同一カテゴリに属する品番登録済みの品名、型式をランダムに10件まで表示します。

# エンドポイント
提供されるAPIエンドポイントについて説明します。各エンドポイントは特定の機能を提供し、指定された形式でリクエストを受け取り、レスポンスを返します。
OpenAPI のドキュメントを参照するには、サーバーを立ち上げてから `localhost:8880/docs` へ接続してください。

---

### 1. 品番カテゴリ予測

#### `POST /predict/category`

品名と型式から予測される品番カテゴリと、その予測確率を返します。

*   **HTTPメソッド**: `POST`
*   **説明**:
    入力された品名と型式に基づき、最も関連性の高い品番カテゴリとその予測確率を返します。複数のカテゴリが候補となる場合、予測確率が高い順に返されます。
*   **リクエストボディ**: `application/json`
    *   `name` (string, 必須): 品名
    *   `model` (string, 必須): 型式
    *   `threshold` (number, オプション): 予測確率のしきい値（この値以上の確率を持つカテゴリのみが返されます）。デフォルト値がコードで定義されている場合があります。
    *   `top_k` (integer, オプション): 返す上位予測カテゴリの数。デフォルト値がコードで定義されている場合があります。
*   **レスポンス**: `application/json`
    *   予測された品番カテゴリとそれに対応する予測確率の辞書。例: `{"CATEGORY_A": 0.98, "CATEGORY_B": 0.01}`
*   **使用例**:

```bash
$ curl -H "Content-Type: application/json" \
-d '{"name":"ブレーカ", "model":"BBW351", "threshold":0.95}' \
localhost:8880/predict/category
```

---

### 2. 諸口品番カテゴリ予測

#### `POST /predict/misc`

品名から予測される諸口品番カテゴリと、その予測確率を返します。

*   **HTTPメソッド**: `POST`
*   **説明**:
    入力された品名に基づき、最も関連性の高い諸口品番カテゴリとその予測確率を返します。諸口品番とは、特定の品番分類に属さない汎用的な部品カテゴリを指します。
*   **リクエストボディ**: `application/json`
    *   `name` (string, 必須): 品名
    *   `threshold` (number, オプション): 予測確率のしきい値。
    *   `top_k` (integer, オプション): 返す上位予測カテゴリの数。
*   **レスポンス**: `application/json`
    *   予測された諸口品番カテゴリとそれに対応する予測確率の辞書。
*   **使用例**:

```bash
$ curl -H "Content-Type: application/json" \
-d '{"name":"シリコンゴム", "threshold":0.95}' \
localhost:8880/predict/misc
```

**レスポンス例**:

```json
{"S_HOZAI":0.8287681977055886,"S_SHOMO":0.11253231047825198,"S_ZAIRYO":0.04253258924038836}
```

---

### 3. 品番情報取得

#### `GET /pid/{parts_num}`

指定された品番のレコード情報を取得します。

*   **HTTPメソッド**: `GET`
*   **説明**:
    URLパスに指定された品番に対応する詳細情報（カテゴリ、品名、型式など）を返します。
*   **パスパラメータ**:
    *   `parts_num` (string, 必須): 取得したい品番。
*   **レスポンス**: `application/json`
    *   指定品番のカテゴリ、品名、型式などを含む辞書。
*   **使用例**:

```bash
$ curl localhost:8880/pid/AAA-101
```

**レスポンス例**:

```json
{
  "カテゴリ": "AAA",
  "品名": "レドーム",
  "型式":"SW218542A"
}
```

---

### 4. カテゴリ別レコード取得

#### `GET /category/{class_}`

指定されたカテゴリに属するレコードをランダムに取得します。

*   **HTTPメソッド**: `GET`
*   **説明**:
    指定されたカテゴリに属する品目のレコードをランダムに`limit`件返します。また、そのカテゴリに関する説明も標準部品記号一覧から取得して含めます。
*   **パスパラメータ**:
    *   `class_` (string, 必須): 取得したいカテゴリ名。
*   **クエリパラメータ**:
    *   `limit` (integer, オプション): 返すレコードの最大件数。デフォルトは `10`。
*   **レスポンス**: `application/json`
    *   `items` (object): 該当カテゴリの品目レコードを格納した辞書。キーは品番、値は品名と型式を持つ辞書。
    *   `text` (string): 指定されたカテゴリに関する説明文。
*   **使用例**:

```bash
$ curl 'localhost:8880/category/AAA?limit=2'
```

**レスポンス例**:

```json
{
  "items": {
    "AAA-1152": {
      "name": "ロープ長さ調整プレートP4 (225)",
      "model": "SZ301173-P4"
    },
    "AAA-9": {
      "name": "カバー",
      "model": "SE209548 改訂1"
    }
  },
  "text": "図番 > 製品名記入"
}
```
